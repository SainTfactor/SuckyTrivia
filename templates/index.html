<!DOCTYPE html>
<html lang="en">
<head>
  <title>Sucky Trivia</title>
  <meta charset="utf-8">
  <link rel='icon' href='http://saintfactorstudios.com/SainTfactorStudiosIP/favicon.ico' type='image/x-icon'/ >
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
  <script src="https://kit.fontawesome.com/2c0cefed81.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/static/main.css">
</head>
<body>

<nav class="navbar navbar-expand">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><img src="http://saintfactorstudios.com/SainTfactorStudiosIP/WingedTTransparent.png" alt="Winged T" height="40" width="40"></a>
    <div class="collapse navbar-collapse">
      <span class="nav navbar-text mr-auto">
        <input @click="change_board('gm-screen')" v-if="!game_started && current_board == 'gm-screen'" class="btn btn-sm warning_link_outline" type="button" value="Import Questions" />
        <input @click="start_game" v-if="!game_started && current_board == 'gm-screen'" class="btn btn-sm warning_link_outline" type="button" value="Start Game" />
        <input @click="" v-if="game_started && current_board == 'gm-screen'" class="btn btn-sm warning_link_outline" type="button" value="View Scores" />
        <input @click="" v-if="game_started && current_board == 'gm-screen'" class="btn btn-sm warning_link_outline" type="button" value="Share Scores" />
      </span>
      <span class="nav navbar-text ml-auto">
        <a href="#" id="leave_game" class="btn btn-sm warning_link_outline" role="button" style="display:none;">Leave Game</a>
      </span>
    </div>
  </div>
</nav>
  
<div class="container-fluid text-center">    
  <div class="row content">
    <div id="left_column" class="col-sm-2 text-center"></div>
    <div class="col-sm-8 text-center"> 
      <!-- Main Screen -->
      <main-screen 
        inline-template 
        v-if="current_board == 'main-screen'" 
        v-on:change_board="change_board">
        <h1>Welcome to Sucky Trivia</h1>
      	<input type="button" class="btn btn-primary" value="Start New Game" @click="$emit('change_board', 'gm-screen')" />
      	<input type="button" class="btn btn-primary" value="Join Game" @click="$emit('change_board', 'player-join')" />
      </main-screen>
      <!-- GM Main Screen -->
      <gm-screen 
        inline-template 
        v-if="current_board == 'gm-screen'" 
        v-on:change_board="change_board"
        :question_tree="question_tree"
        :game_started="game_started"
        :roomcode="roomcode">
        <h1>Welcome to your game!</h1>
        <h2>Game Code: <span style="font-weight:bold;">{{ roomcode }}</span></h2>
        <div class="question_here">{{ question_tree.questions[question_tree.current_question].question }}</div>
        <div class="answer_here" 
          v-if="game_started && question_tree.questions[question_tree.current_question].answer_shown">
            {{ question_tree.questions[question_tree.current_question].answer }}
        </div>
        <div id="controls" v-if="game_started" style="display:none;">          
          <input id="previous_question" :disable="question_tree.current_question == 0" class="btn btn-sm btn-primary" type="button" value="Previous" />
	        <input id="lock_all_answers" :disable="question_tree.questions[question_tree.current_question].answer_shown" class="btn btn-sm btn-primary" type="button" value="Lock all Answers" />
          <input id="show_answer" :disable="question_tree.questions[question_tree.current_question].answer_shown" class="btn btn-sm btn-primary" type="button" value="Show Answer" />
          <input id="next_question" :disable="question_tree.current_question == question_tree.questions.length -1" class="btn btn-sm btn-primary" type="button" value="Next" />
        </div>
        <div id="player_info_area" data-bind="foreach: players" class="row">
          <div v-for="player in question_tree.players" class="col-12 col-sm-6 col-md-4 col-lg-3 box_wrapper">
            <div class="user-box">
              <h4>{{ player.name }}</h4>
	            <div class="player_answer_points"></div>
              <div class="player_answer"></div>
              <div class="player_answer_lock">
                  <i class="fas fa-lock" @click="unlock_user(player)" style="cursor:pointer"></i>
              </div>
            </div>
          </div>
        </div>
      </gm-screen>
      <!-- Input questions Screen -->
      <input-questions 
        inline-template 
        v-if="current_board == 'input-questions'" 
        v-on:change_board="change_board"
        :question_tree="question_tree">
        <h1 style="display: inline-block;">Input your trivia questions!!!</h1>
        <button type="button" style="margin-bottom:20px;margin-left:20px;" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#game_modal">
          Help
        </button>
        <div class="row">
            <div class="col-4">
              <textarea @change="queue_process_questions" v-model="questions_raw" class="form-control" rows="18" placeholder="[Round 1: Inane garbage]&#10;&#10;This is my first question?&#10;Yes it is.&#10;5pts&#10;&#10;But is this the THIRD question?&#10;Nope&#10;10&#10;&#10;[Good job guys.  Another question incoming!!]&#10;&#10;Name one of the first three prime numbers&#10;2|3|5&#10;7 points"></textarea>
              <input class="btn btn-lg btn-primary" type="button" value="Save Questions" />
            </div>
            <div class="col-8">
              <div class="row preview_area">
                  <div v-for="question in questions" class="col-12 col-lg-6 box_wrapper">
                    <div class="question-box">
                      <h5>
                        <span class="preview_question">{{ question.question }}</span>
                          <small v-if="question.points != ''"> ({{ question.points }}pts.)</small>
                      </h5>
                      <div>{{ question.answer }}</div>
                    </div>
                  </div>
              </div>
            </div>
        </div>
      </input-questions>
      <!-- Leaderboard Screen -->
      <leader-board 
        inline-template 
        v-if="current_board == 'leader-board'" 
        v-on:change_board="change_board"
        :question_tree="question_tree">
        <h1>Current Scores</h1>
        <table id="leader_board_info" class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">User</th>
              <th scope="col">Score</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="entry in leaderboard">
              <th>{{ entry.place }}</th>
              <td>{{ entry.player_name }}</td>
              <td>{{ entry.score }}</td>
            </tr>
            </tr>
          </tbody>
        </table>
        <input class="btn btn-lg btn-primary"  type="button" value="Back" @click="$emit('change_board', 'gm-screen')" />
        <input class="btn btn-lg btn-primary" :disabled="true" type="button" value="Finish Game" @click="$emit('finish_game')" />
      </leader-board>
      <!-- Player Join Room Screen -->
      <player-join 
        inline-template 
        v-if="current_board == 'player-join'" 
        v-on:change_board="change_board"
        :username="username"
        :roomcode="roomcode">
        <h1>Type in your username and room code</h1>        
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" id="username-label">Username</span>
          </div>
          <input v-model="username" class="form-control" type="text" placeholder="Username" aria-label="Username" aria-describedby="username-label" />
        </div>
        <div class="input-group">
          <div class="input-group-prepend">
            <span class="input-group-text" id="room-code-label">Room Code</span>
          </div>
          <input v-model="roomcode" class="form-control" type="text" placeholder="Room Code" aria-label="Room Code" aria-describedby="room-code-label" />
        </div>        
        <input @click="$emit('change_board', 'player-screen')" class="btn btn-lg btn-primary" type="button" value="Join" />
      </player-join>
      <!-- Player Main Screen -->
      <player-screen 
        inline-template 
        v-if="current_board == 'player-screen'" 
        v-on:change_board="change_board">
        <h1>Sucky trivia</h1>
        <div class="question_here">{{ question }}</div>
        <div class="answer_here">{{ answer }}</div>
        <input v-model="guess" :disabled="locked" class="form-control" type="text" placeholder="Type your answers here." />
        <input @click="lock_answer" :disabled="locked" class="btn btn-lg btn-primary" type="button" value="Lock in Answer" />
      </player-screen>
      <div id="right_column" class="col-sm-2 text-center"></div>
    </div>
  </div>
</div>


<!-- Modal -->
<div id="game_modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <p>
          Questions should be input in the format shown below.
        </p><p>
          (Question > answer > point value, all on seperate lines, and a blank line between questions).  
        </p><p>
          Multiple correct answers can be separated by the "|" character.  
        </p><p>
          Non-question slides should be enclosed in square brackets "[Like this]" (Useful for round title slides).
        </p><p>
          If you want an image included in your question, simply enclose the the url of the image in double square brackets.
        </p><p>
          Ex. [[https://mymodernmet.com/wp/wp-content/uploads/2018/10/Mou-Aysha-portrait-photography-3.jpg]]
        </p><p>
          If you want to add a song snippet to be included in your question, simply enclose your song title (or search term) in double curly braces.  Note: this feature is definitely not 100% fleshed out, so make sure all the previews on the right side actually have the song.
        </p><p>
          Ex. Who sings this song? {% raw %}{{steal my sunshine}}{% endraw %}.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<script src="/static/shared.js"></script>
<script src="/static/main-screen.js"></script>
<script src="/static/gm-screen.js"></script>
<script src="/static/player-screen.js"></script>
<script src="/static/input-questions.js"></script>
<script src="/static/leaderboard.js"></script>
<script src="/static/player-join.js"></script>
<script>
  var main = new Vue({
    el: 'body',
    data: {
      // shared_vars_all
      current_board: "main-screen",
      game_started: false,
      // gm_shared_vars
      question_tree: {
        questions: [],
        players: [],
        current_question: -1,
        leaderboard: []
      },
      // player_shared_vars
      username: "",
      roomcode: ""
    }, 
    components: {
      "main-screen" : main_screen,
      "gm-screen" : gm_screen,
      "player-screen" : player_screen,
      "input-questions" : input_questions,
      "leader-board" : leader_board,
      "player-join" : player_join
    },
    methods: {
      change_board: function(board) {
        this.current_board = board
      },
      start_game: function() {
        this.change_board("gm-screen")
        this.game_started = true;
      },
      finish_game: function() {
        this.game_started=false;
        this.change_board("gm-screen")
        socket.emit('send_question', "");
        self.question_tree.current_question(-1);
        socket.emit('unlock', {});
        self.question_tree = {
          questions: [],
          players: [],
          current_question: -1,
          leaderboard: []
        }
      }
    }
  })
</script>

</body>
</html>
